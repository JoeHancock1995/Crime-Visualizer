
<!DOCTYPE html>
<html lang="en">

<head>
    <!--Plotly.js-->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
    <div class="showcase__section" id="bubble">
        <div class="spacer --small"></div>
        <div id="bubbleplots">
            <div class="bubbleplot" data-num="0">
                <div class="plot" id="plotdiv"></div>
                <div class="control-row">
                    Year: <select class="yeardata">
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script>
    Plotly.d3.csv('./crime.csv', function (err, rows) {

        function unpack(rows, key) {
            return rows.map(function (row) { return row[key]; });
        }

        var allYear = unpack(rows, 'year'),
            allMonths = unpack(rows, 'month'),
            allMurders = unpack(rows, 'murders')
        listofYear = [],
            currentYear = [],
            currentMonth = [],
            currentMurders = [];

        for (var i = 0; i < allYear.length; i++) {
            if (listofYear.indexOf(allYear[i]) === -1) {
                listofYear.push(allYear[i]);
            }
        }

        function getYearData(chosenYear) {
            currentMonth = [];
            currentMurders = [];
            for (var i = 0; i < allYear.length; i++) {
                if (allYear[i] === chosenYear) {
                    currentMonth.push(allMonths[i]);
                    currentMurders.push(allMurders[i]);
                }
            }
        };

        // Default Country Data
        setBubblePlot('2020');

        function setBubblePlot(chosenYear) {
            getYearData(chosenYear);

            var trace1 = {
                x: currentMonth,
                y: currentMurders,
                mode: 'lines+markers',
                marker: {
                    size: 12,
                    opacity: 0.5
                }
            };

            var data = [trace1];

            var layout = {
                title: 'Line and Scatter Plot',
                height: 400,
                width: 480
            };

            Plotly.newPlot('plotdiv', data, layout);
        };

        var innerContainer = document.querySelector('[data-num="0"'),
            plotEl = innerContainer.querySelector('.plot'),
            yearSelector = innerContainer.querySelector('.yeardata');

        function assignOptions(textArray, selector) {
            for (var i = 0; i < textArray.length; i++) {
                var currentOption = document.createElement('option');
                currentOption.text = textArray[i];
                selector.appendChild(currentYear);
            }
        }

        assignOptions(listofYear, yearSelector);

        function updateYear() {
            setBubblePlot(yearSelector.value);
        }

        yearSelector.addEventListener('change', updateYear, false);
    });
    </script>
</body>
</html>